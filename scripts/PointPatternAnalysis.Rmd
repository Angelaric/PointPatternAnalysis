---
title: "Point Pattern Analysis"
author: "Angel Bogdanov Grigorov"
date: "Created 28 Feb. 2023, updated `r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    highlight: tango
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

In this file I will make a point pattern analysis of the settlement distribution for the different periods in the Kazanlak valley. 

Този анализ ще бъде направен за селищата. За тази цел селектирам само видовете обекти от типа: "Type" = 'Бани' OR "Type" = 'Военен лагер/ град' OR "Type" = 'Град' OR "Type" OR "Type" = 'Единична постройка' OR "Type" = 'Единична постройка?' OR "Type" = 'Крепост' OR "Type" = 'Крепост/ кула?' OR "Type" = 'Крепост/ светилище?' OR "Type" = 'Крепост/ селище?' OR "Type" = 'Крепост?' OR "Type" = 'Кула' OR "Type" = 'Кула?' OR "Type" = 'Манастир' OR "Type" = 'Манастир/ черква?' OR "Type" = 'Пътна станция' OR "Type" = 'Пътна станция?' OR "Type" = 'Светилище' OR "Type" = 'Светилище/ селище?' OR "Type" = 'Светилище?' OR "Type" = 'Селище' OR "Type" = 'Селище?' OR "Type" = 'Селищна могила' OR "Type" = 'Стопанство' OR "Type" = 'Стопанство/ селище' OR "Type" = 'Укрепен град' OR "Type" = 'Укрепление?'

От анализа изключих храмове и църкви, защото обикновено те са част или са близо до селищата. 

За статистическия анализ са избрани четири територии: 
Обхваща западната част на котловината:
D:/2_Diss_GIT_Scripts/PointPatternAnalysis/data/Box1.shp
Обхваща източната част на котловината: 
D:/2_Diss_GIT_Scripts/PointPatternAnalysis/data/Box2.shp
Обхваща централната част на котловината по протежението на тунджа: 
D:/2_Diss_GIT_Scripts/PointPatternAnalysis/data/Rectangular.shp
Цялата територия на изследваната територия (петте общини):
D:/2_Diss_GIT_Scripts/PointPatternAnalysis/data/Municipal.shp

## Load library

```{r}

library(tidyverse)
library(here)
library(dplyr)
library(ggplot2)

```

## Load data

In the following chunk, you will load a csv that ....Това е csv файлът с всичките обекти и даните за тях от Казанлъшката котловина. Файлът включва и обекти, основно крепости, които са регистрирани извън изследваната територия, основно да служат като спомагателни при анализите с пътищата. Когаро използваш csv трябва да се увериш, че координатите ти са с точки, а не със запетайки. Ако са със запетайки R няма да разпознае кординатите и това ще ти доведе масови главоболия. Ако случайно Гугъл шитът астроен да слага запетайки при числата вместо точки, лесно можеш да промениш това от "Файл" -> "Настройки" -> и да промениш "Локал" на "Съединени щати". След това си експортираш файла на в csv и си го зареждаш в R.
```{r data}

Sites <- read_csv(here("data/ChronCatalogue6Extract.csv")) 
head(Sites)
```
## Settlements = 1

Този раздел включва филтрирането и селектирането на всичките обекти със селищни функции, които са само със сигурни дати в съответният период и попадат само в територийте на петте общини: Павел баня, Казанлък, Мъглиж, Гурково и Николаево

# Solution
```{r}

Settlements1 <- Sites %>% filter(Община=="Павел баня" | Община=="Казанлък" | Община=="Мъглиж" | Община=="Гурково" | Община=="Николаево")%>%
  
# unique(Settlements1$Община)

 
# След това филтрирам само обектите, които по един или друг начин, могат да бъдат класифицирани като селища:
  
  filter(Вид == "Бани" | Вид == "Военен лагер/ град" | Вид == "Град" | Вид == "Единична постройка" | Вид == "Единична постройка?" | Вид == "Крепост" | Вид == "Крепост/ кула?" | Вид == "Крепост/ светилище?" | Вид == "Крепост/ селище?" | Вид == "Крепост?" | Вид == "Кула" | Вид == "Кула?" | Вид == "Манастир" | Вид == "Манастир/ черква?" | Вид == "Пътна станция" | Вид == "Пътна станция?" | Вид == "Светилище" | Вид == "Светилище/ селище?" | Вид == "Светилище?" | Вид == "Селище" | Вид == "Селище?" | Вид == "Селищна могила" | Вид == "Стопанство" | Вид == "Стопанство/ селище" | Вид == "Укрепен град" | Вид == "Укрепление?")


Settlements1 %>% 
   filter( Пра.==1 | Палео.==1 | Нео.==1 | РНео.==1 | СНео.==1 | КНео.==1 | Х==1 | РХ==1 | КХ==1) %>% 
  mutate(Праистория=Пра.+Палео.+Нео.+РНео.+СНео.+КНео.+Х+РХ+КХ) %>%
  pull(Праистория)


Settlements1 %>% 
  filter( КА==1 | КРЕ==1 |РВ ==1 ) %>% 
  mutate(Късноантична=КА+КРЕ+РВ) %>%
  pull(Късноантична)
  
Settlements1 %>% 
  filter( ЖЕ==1 | РЖЕ==1 | РЖЕ1==1 | РЖЕ2==1 | КЖЕ==1 | КЖЕ1==1 | КЖЕ2==1 | К==1 | Ел.==1 | РЕл.==1 | КЕл.==1  ) %>% 
  mutate(Желязна=ЖЕ+РЖЕ+РЖЕ1+РЖЕ2+КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.) %>%
  #filter(Желязна >=1) %>% 
  pull(Желязна)
```

# Angels original

```{r}

# Това са филтрите за селищата, които са със сигурни дати, т.е. кодове 1. Махнати са обектите с несигурни дати, т.е. кодираните с 2. 

# Селектирам само обектите (записите), които попадат в петте общини (територията на изследване). Тъй като тук ще работим само със сигурно датирани обекти, т.е. кодирани с 1, кръщаваме файла Settlements1.  

Settlements1 <- Sites %>% filter(Община=="Павел баня" | Община=="Казанлък" | Община=="Мъглиж" | Община=="Гурково" | Община=="Николаево")%>%
  
# unique(Settlements1$Община)

 
# След това филтрирам само обектите, които по един или друг начин, могат да бъдат класифицирани като селища:
  
  filter(Вид == "Бани" | Вид == "Военен лагер/ град" | Вид == "Град" | Вид == "Единична постройка" | Вид == "Единична постройка?" | Вид == "Крепост" | Вид == "Крепост/ кула?" | Вид == "Крепост/ светилище?" | Вид == "Крепост/ селище?" | Вид == "Крепост?" | Вид == "Кула" | Вид == "Кула?" | Вид == "Манастир" | Вид == "Манастир/ черква?" | Вид == "Пътна станция" | Вид == "Пътна станция?" | Вид == "Светилище" | Вид == "Светилище/ селище?" | Вид == "Светилище?" | Вид == "Селище" | Вид == "Селище?" | Вид == "Селищна могила" | Вид == "Стопанство" | Вид == "Стопанство/ селище" | Вид == "Укрепен град" | Вид == "Укрепление?")%>%
  
# unique(Settlements1$Вид)
  
# Следващата стъпка е да филтрирам само обектите със сигурни дати, без такива с колебаещи се дати. Това значи, че избирами за всяка епоха код == 1, а код 2 отпада. 
  filter( Пра.==1 | Палео.==1 | Нео.==1 | РНео.==1 | СНео.==1 | КНео.==1 | Х==1 | РХ==1 | КХ==1 | БЕ==1 | РБЕ==1 | РБЕ1==1 | РБЕ2==1 | РБЕ3==1 | СБЕ==1 | КБЕ==1 | ЖЕ==1 | РЖЕ==1 | РЖЕ1==1 | РЖЕ2==1 | КЖЕ==1 | КЖЕ1==1 | КЖЕ2==1 | А==1 | К==1 | Ел.==1 | РЕл.==1 | КЕл.==1 | РЕ==1 | КА==1 | КРЕ==1 | РВ==1 | Ср.==1 | РСр.==1 | ЗСр.==1 | КСр.==1 | ПБЦ==1 | ВБЦ==1 | Възраждане==1 | Неопр.==1)%>%
  
  
# Следващите редове ще направя колони в които ще бъдат събрани всичките кодове. По този начин ще мога да селектирам всичките обекти от праисторията или от средновековието. 
  
# Първо ще направим колона, в която ще обединим всичките праисторически обекти:
  

   
  # Сега и за останалите епохи
  
  # Неолит:
  
  mutate(Неолит=Нео.+РНео.+СНео.+КНео.)%>%
  
  # Халколит:

  mutate(Халколит=Х+РХ+КХ)%>%
  
  # Бронзова епоха

  mutate(Бронз=БЕ+РБЕ+РБЕ1+РБЕ2+РБЕ3+СБЕ+КБЕ)%>%
  
  # Раннобронзова:
  
  mutate(Раннобронзова=РБЕ+РБЕ1+РБЕ2+РБЕ3)%>%
  
  # СБЕ няма регистрирани обекти.
  
  # КБЕ няма други подпериоди, така че за нея ще използвам колоната КБЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1  
  
  # Желязна

  mutate(Желязна=ЖЕ+РЖЕ+РЖЕ1+РЖЕ2+КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Ранножелязна:

  mutate(Ранножелязна=РЖЕ+РЖЕ1+РЖЕ2)%>%
  
  # Късножелязна:

  mutate(Късножелязна=КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Елинизъм:

  mutate(Елинизъм=Ел.+РЕл.+КЕл.)%>%
  
  # За римската епоха няма други подпериоди, така че за него ще използвам колоната РЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1
  
  # За късноримската епоха няма други подпериоди, така че за него ще използвам колоната КРЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1

  # Късноантична:

  mutate(Късноантична=КА+КРЕ+РВ)%>%

# Средновеквие (без Късното):

  mutate(СредновековиеXIV=Ср.+РСр.+ЗСр.+ПБЦ+ВБЦ)%>%

# Средновеквие (с Късното)

  mutate(СредновековиеXVII=Ср.+РСр.+ЗСр.+КСр.+ПБЦ+ВБЦ)%>%
  
# Ранно средновековие

  mutate(Ранноср.=РСр.+ПБЦ)%>%

# Зряло средновековие

  mutate(Зрялоср.=ЗСр.+ВБЦ)

# Късното средновековие няма други подпериоди, така че за него ще използвам колоната КСр. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1

Settlements1

```

```{r}

# Тук селектирам само колоните, които ще са ми нужни, за да не затормозявам програмата с излишни такива. 

Settlements1 <- select(Settlements1, Cat, E_coord:N_coord, Вид, КБЕ, РЕ, КРЕ, Праистория:Зрялоср., КСр.)

Settlements1

unique(Settlements1$КБЕ)
unique(Settlements1$РЕ)
unique(Settlements1$КРЕ)
unique(Settlements1$Праистория)
unique(Settlements1$Неолит)
unique(Settlements1$Халколит)
unique(Settlements1$Бронз)
unique(Settlements1$Раннобронзова)
unique(Settlements1$Желязна)
unique(Settlements1$Ранножелязна)
unique(Settlements1$Късножелязна)
unique(Settlements1$Елинизъм)
unique(Settlements1$Късноантична)
unique(Settlements1$СредновековиеXIV)
unique(Settlements1$СредновековиеXVII)
unique(Settlements1$Ранноср.)
unique(Settlements1$Зрялоср.)
unique(Settlements1$КСр.)

```

```{r}

# Новосъздадената data frame я експортирам като нов csv файл. 

write.csv(Settlements1, here("data/Settlements1.csv"), row.names=TRUE) # Дотук всичко е вярно и съвпада със селекцията в АркГИС

```

```{r}
# Тъй като сега ще трябва да направя от този файл Simple Feature зареждаме `sf` for working with vector data

library(sf)

```

```{r}

# Convert the data frame to an sf object 

Settlements1_sf <- st_as_sf(Settlements1, coords = c("E_coord", "N_coord"), crs=4326)%>%
  st_transform(crs = 32635)

st_crs(Settlements1_sf)

Settlements1_sf

```

## Settlements = 1+2 

Този раздел включва филтрирането и селектирането на всичките обекти със селищни функции, които са със сигурни или несигурни дати в съответният период и попадат само в територийте на петте общини: Павел баня, Казанлък, Мъглиж, Гурково и Николаево

```{r}

# Това е csv файлът, който заредих по-горе, с всичките обекти и даните за тях от Казанлъшката котловина. Файлът включва и обекти, основно крепости, които са регистрирани извън изследваната територия, основно да служат като спомагателни при анализите с пътищата.    

Sites

# Селектирам само обектите (записите), които попадат в петте общини (територията на изследване). Тъй като тук ще работим и с несигурно датирани обекти, т.е. кодирани с 1 и 2, кръщаваме файла Settlements1_2.  

Settlements1_2 <- filter(Sites, Община=="Павел баня" | Община=="Казанлък" | Община=="Мъглиж" | Община=="Гурково" | Община=="Николаево")%>%
  
# unique(Settlements1$Община)

# След това филтрирам само обектите, които по един или друг начин, могат да бъдат класифицирани като селища:
  
  filter(Вид == "Бани" | Вид == "Военен лагер/ град" | Вид == "Град" | Вид == "Единична постройка" | Вид == "Единична постройка?" | Вид == "Крепост" | Вид == "Крепост/ кула?" | Вид == "Крепост/ светилище?" | Вид == "Крепост/ селище?" | Вид == "Крепост?" | Вид == "Кула" | Вид == "Кула?" | Вид == "Манастир" | Вид == "Манастир/ черква?" | Вид == "Пътна станция" | Вид == "Пътна станция?" | Вид == "Светилище" | Вид == "Светилище/ селище?" | Вид == "Светилище?" | Вид == "Селище" | Вид == "Селище?" | Вид == "Селищна могила" | Вид == "Стопанство" | Вид == "Стопанство/ селище" | Вид == "Укрепен град" | Вид == "Укрепление?")%>%
  
# unique(Settlements1$Вид)
  
# Следващата стъпка е да филтрирам обектите със сигурни и несигурни дати, без такива с колебаещи се дати. Това значи, че избирами за всяка епоха код >= 1 
  filter( Пра.>=1 | Палео.>=1 | Нео.>=1 | РНео.>=1 | СНео.>=1 | КНео.>=1 | Х>=1 | РХ>=1 | КХ>=1 | БЕ>=1 | РБЕ>=1 | РБЕ1>=1 | РБЕ2>=1 | РБЕ3>=1 | СБЕ>=1 | КБЕ>=1 | ЖЕ>=1 | РЖЕ>=1 | РЖЕ1>=1 | РЖЕ2>=1 | КЖЕ>=1 | КЖЕ1>=1 | КЖЕ2>=1 | А>=1 | К>=1 | Ел.>=1 | РЕл.>=1 | КЕл.>=1 | РЕ>=1 | КА>=1 | КРЕ>=1 | РВ>=1 | Ср.>=1 | РСр.>=1 | ЗСр.>=1 | КСр.>=1 | ПБЦ>=1 | ВБЦ>=1 | Възраждане>=1 | Неопр.>=1)%>%
  
# Следващите редове ще направя колони в които ще бъдат събрани всичките кодове. По този начин ще мога да селектирам всичките обекти от праисторията или от средновековието. 
  
# Първо ще направим колона, в която ще обединим всичките праисторически обекти:
  
  mutate(Праистория=Пра.+Палео.+Нео.+РНео.+СНео.+КНео.+Х+РХ+КХ)%>%
  
  # Сега и за останалите епохи
  
  # Неолит:
  
  mutate(Неолит=Нео.+РНео.+СНео.+КНео.)%>%
  
  # Халколит:

  mutate(Халколит=Х+РХ+КХ)%>%
  
  # Бронзова епоха

  mutate(Бронз=БЕ+РБЕ+РБЕ1+РБЕ2+РБЕ3+СБЕ+КБЕ)%>%
  
  # Раннобронзова:
  
  mutate(Раннобронзова=РБЕ+РБЕ1+РБЕ2+РБЕ3)%>%
  
  # СБЕ няма регистрирани обекти
  
  # КБЕ няма други подпериоди, така че за нея ще използвам колоната КБЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1
  
  # Желязна

  mutate(Желязна=ЖЕ+РЖЕ+РЖЕ1+РЖЕ2+КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Ранножелязна:

  mutate(Ранножелязна=РЖЕ+РЖЕ1+РЖЕ2)%>%
  
  # Късножелязна:

  mutate(Късножелязна=КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Елинизъм:

  mutate(Елинизъм=Ел.+РЕл.+КЕл.)%>%
  
  # За римската епоха няма други подпериоди, така че за него ще използвам колоната РЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1
  
  # За късноримската епоха няма други подпериоди, така че за него ще използвам колоната КРЕ. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1

  # Късноантична:

  mutate(Късноантична=КА+КРЕ+РВ)%>%

# Средновеквие (без Късното):

  mutate(СредновековиеXIV=Ср.+РСр.+ЗСр.+ПБЦ+ВБЦ)%>%

# Средновеквие (с Късното)

  mutate(СредновековиеXVII=Ср.+РСр.+ЗСр.+КСр.+ПБЦ+ВБЦ)%>%
  
# Ранно средновековие

  mutate(Ранноср.=РСр.+ПБЦ)%>%

# Зряло средновековие

  mutate(Зрялоср.=ЗСр.+ВБЦ)

# Късното средновековие няма други подпериоди, така че за него ще използвам колоната КСр. Когато селектираш обектите от този период, не забравяй, че тук не си използвал мутейт, и ако искаш да избереш само тези с точна дата, трябва да е == 1, а ако искаш да включиш и тези с несигурна дата, трябва да филтрираш с >= 1

Settlements1_2

```

```{r}

# Тук селектирам само колоните, които ще са ми нужни, за да не затормозявам програмата с излишни такива. 
# Забележи функцията dplyr::select(). Това е защото съм заредил и функцията sf(), която се конфронтира с dplyr и се появява грешка, за това трябваше изрично да кажа, на R, че искам да използвам функцията select() на dplyr

Settlements1_2 <- dplyr::select(Settlements1_2, Cat, E_coord:N_coord, Вид, КБЕ, РЕ, КРЕ, Праистория:Зрялоср., КСр.)

Settlements1_2

```

```{r}

# Новосъздадената data frame я експортирам като нов csv файл. 

write.csv(Settlements1_2, here("data/Settlements1_2.csv"), row.names=TRUE) # Дотук всичко е вярно и съвпада със селекцията в АркГИС

```

```{r}

# Ако не сме заредили sf() тъй като сега ще трябва да направя от този файл Simple Feature трябва да го заредим. Аз съм го направил горе, затова го оставям коментирано.

# library(sf)

# Convert the data frame to an sf object (for working with vector data)

Settlements1_2_sf <- st_as_sf(Settlements1_2, coords = c("E_coord", "N_coord"), crs=4326)%>%
  st_transform(crs = 32635)

st_crs(Settlements1_2_sf)

Settlements1_2_sf

```

```{r}

library(raster)

```

### Point Pattern Analysis

```{r}

# Това е цялата територия нужна за анализите. В този растер Тунджа е кодирана с 0, което означава, че тя ще бъде разпознавана от модела като бариера и няма да го пропуска да преминава през нея. Към Тунджа са добавени бродовете, които съм регистрирал. Те ще служат за места, където моделът ще може да пресече реката.

Teritory <- raster("Z:/Daisy_20220720/(_1_Tasks_DN/Shps/Sites/MainDirections/Directions.tif")

# Това са тестовите територий, в които ще се извърши point pattern анализа

Box1 <-st_read("../data/Box1.shp")%>%
  as_Spatial()

Box2 <-st_read("../data/Box2.shp")%>%
  as_Spatial()

Municipal <-st_read("../data/Municipal.shp")%>%
  as_Spatial()

Rectangular <-st_read("../data/Rectangular.shp")%>%
  as_Spatial()

# see what it looks like

# Ploting the territory with the certain dated settlements 
plot(Teritory); plot(Box1, border="green", add=TRUE); plot(Box2, border="yellow", add=TRUE); plot(Municipal, border="red", add=TRUE); plot(Rectangular, border="blue", add=TRUE); plot(Settlements1_sf$geometry, cex=0.1, pch = 16, col="firebrick", add = T)

# Ploting the territory including the the uncertain dated settlements too
plot(Teritory); plot(Box1, border="green", add=TRUE); plot(Box2, border="yellow", add=TRUE); plot(Municipal, border="red", add=TRUE); plot(Rectangular, border="blue", add=TRUE); plot(Settlements1_2_sf$geometry, cex=0.1, pch = 16, col="firebrick", add = T)


```

```{r}

# First install package spatstat

# install.packages("spatstat")
library(spatstat)
library(spatstat.data)
library(rpart)
library(nlme)
library(maptools)

```

```{r}

# After that:

# Make a simple feature 'Box1' polygon into an owin object

Box1_w <- as.owin.SpatialPolygons(Box1)

# Make a simple feature 'Box2' polygon into an owin object

Box2_w <- as.owin.SpatialPolygons(Box2)

# Make a simple feature 'Municipal' polygon into an owin object

Municipal_w <- as.owin.SpatialPolygons(Municipal)

# Make a simple feature 'Rectangular' polygon into an owin object

Rectangular_w <- as.owin.SpatialPolygons(Rectangular)

```

### Prehistoric

```{r}

# Селектираме само праисторическите (само селища), които са 

PreSettlemnts1 <- Settlements1_sf %>%
  filter(Праистория>=1)

# see what it looks like

plot(Teritory); plot(Box1, border="green", add=TRUE); plot(Box2, border="yellow", add=TRUE); plot(Municipal, border="red", add=TRUE); plot(Rectangular, border="blue", add=TRUE); plot(PreSettlemnts1$geometry, cex=0.1, pch = 16, col="firebrick", add = T)

```


```{r}

# Finally, create the ppp from settlements within Municipal box

x <- st_coordinates(PreSettlemnts1)[,1]
y <- st_coordinates(PreSettlemnts1)[,2]
plot(Municipal_w)
plot(as.ppp(PreSettlemnts1),add = T)

PreSettlemnts1_ppp <- as.ppp(st_coordinates(PreSettlemnts1), W=Municipal_w)

PreSettlemnts1_ppp

plot(PreSettlemnts1_ppp)

```


```{r}

# Calculate nearest-neighbor distances for PreSettlemnts1 (the certain dated Prehistoric settlements) data using Municipalityes (the boundaries of the examined territory/ Kazanlak Valley) as a box 

nnd_PreSettlemnts1 <- nndist(PreSettlemnts1_ppp)

mean_nn <- mean(nnd_PreSettlemnts1)

# RAndom mean distances in your study area (Municipal)

mean_dist <- 0.5*sqrt(st_area(st_as_sf(Municipal))/nrow(PreSettlemnts1))

r <- mean_nn/mean_dist
# THe box Municipal is perhaps too big, making the ratio clustered at 0.43, so we need a different box

```
## LIA

```{r}

# Селектираме само късножелезните обекти от файла Sites1_sf, който съдържа само обекти от типа селища, датирани със сигурност в КЖЕ

LIASettlemnts1 <- Settlements1_sf %>%
  filter(Късножелязна>=1)

# LIASettlemnts1_2 <- Settlements1_2_sf %>% filter(Късножелязна>=1) # Няма разлика в бройката между само сигурно датираните в КЖЕ селищата и тези, които са с несигурни дати.

# see what it looks like

plot(Teritory); plot(Box1, border="green", add=TRUE); plot(Box2, border="yellow", add=TRUE); plot(Municipal, border="red", add=TRUE); plot(Rectangular, border="blue", add=TRUE); plot(LIASettlemnts1$geometry, cex=0.1, pch = 16, col="firebrick", add = T)

# Finally, create the ppp from settlements within Municipal box

x <- st_coordinates(LIASettlemnts1)[,1]
y <- st_coordinates(LIASettlemnts1)[,2]
plot(Municipal_w)
plot(as.ppp(LIASettlemnts1),add = T)

LIASettlemnts1_ppp <- as.ppp(st_coordinates(LIASettlemnts1), W=Municipal_w)

LIASettlemnts1_ppp

plot(LIASettlemnts1_ppp)

# Calculate nearest-neighbor distances for PreSettlemnts1 (the certain dated Prehistoric settlements) data using Municipalityes (the boundaries of the examined territory/ Kazanlak Valley) as a box 

nnd_LIASettlemnts1 <- nndist(LIASettlemnts1_ppp)

mean_nn <- mean(nnd_LIASettlemnts1)

# RAndom mean distances in your study area (Municipal)

mean_dist <- 0.5*sqrt(st_area(st_as_sf(Municipal))/nrow(LIASettlemnts1))

r <- mean_nn/mean_dist

# The box Municipal is perhaps too big, making the ratio clustered at 0.43, so we need a different box

```

```{r}

# КБЕ. Резултатите съвпадат с резултатите от ГИС.

LBESettlemnts1 <- Settlements1 %>%
  filter(КБЕ==1)

LBElemnts1_2 <- Settlements1_2 %>%
  filter(КБЕ>=1)

LBESettlemnts1

LBElemnts1_2





# РЕ. Резултатите съвпадат с резултатите от ГИС.

RPSettlemnts1 <- Settlements1 %>%
  filter(РЕ==1)

RPlemnts1_2 <- Settlements1_2 %>%
  filter(РЕ>=1)

RPSettlemnts1

RPlemnts1_2




# КРЕ. Резултатите съвпадат с резултатите от ГИС.

LRPSettlemnts1 <- Settlements1 %>%
  filter(КРЕ==1)

LRPlemnts1_2 <- Settlements1_2 %>%
  filter(КРЕ>=1)

LRPSettlemnts1

LRPlemnts1_2




# Праистория. Резултатите съвпадат с резултатите от ГИС.

PreSettlemnts1 <- Settlements1 %>%
  filter(Праистория>=1)

PreSlemnts1_2 <- Settlements1_2 %>%
  filter(Праистория>=1)

PreSettlemnts1

PreSlemnts1_2




# Неолит. Резултатите съвпадат с резултатите от ГИС.

NeoSettlemnts1 <- Settlements1 %>%
  filter(Неолит>=1)

NeoSlemnts1_2 <- Settlements1_2 %>%
  filter(Неолит>=1)

NeoSettlemnts1

NeoSlemnts1_2





# Халколит. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 12, а Settlements1_2 13. В случая двата вида са по 13. Някъде се получава грешка при mutate()... 

HalcSettlemnts1 <- Settlements1 %>%
  filter(Халколит>=1)

HalcSlemnts1_2 <- Settlements1_2 %>%
  filter(Халколит>=1)

HalcSettlemnts1 # Трябва да са 12

HalcSlemnts1_2 # Трябва да са 13



# БЕ. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 12, а Settlements1_2 13. В случая двата вида са по 13. Някъде се получава грешка при mutate()...

BASettlemnts1 <- Settlements1 %>%
  filter(Бронз>=1)

BASlemnts1_2 <- Settlements1_2 %>%
  filter(Бронз>=1)

BASettlemnts1 # Трябва да са 12

BASlemnts1_2 # Трябва да са 13





# РБЕ. Резултатите съвпадат с резултатите от ГИС. Но това е изкуствено заблуждение. Съвпадението е породено от това, че в КБЕ просто няма обекти с код 2. Проблемът с mutate() си остава. 

EBASettlemnts1 <- Settlements1 %>%
  filter(Раннобронзова>=1)

EBASlemnts1_2 <- Settlements1_2 %>%
  filter(Раннобронзова>=1)

EBASettlemnts1

EBASlemnts1_2





# ЖЕ. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 81, а Settlements1_2 87. В случая двата вида са по 86. Даже и едно съвпадение няма. Някъде се получава грешка при mutate()...

IASettlemnts1 <- Settlements1 %>%
  filter(Желязна>=1)

IASettlemnts1_2 <- Settlements1_2 %>%
  filter(Желязна>=1)

IASettlemnts1 # Трябва да са 81

IASettlemnts1_2 # Трябва да са 87





# РЖЕ. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 16, а Settlements1_2 18. В случая двата вида са по 18. Някъде се получава грешка при mutate()...

EIASettlemnts1 <- Settlements1 %>%
  filter(Ранножелязна>=1)

EIASettlemnts1_2 <- Settlements1_2 %>%
  filter(Ранножелязна>=1)

EIASettlemnts1 # Трябва да са 16

EIASettlemnts1_2 # Трябва да са 18





# КЖЕ. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 71, а Settlements1_2 76. В случая двата вида са по 75. Даже и едно съвпадение няма. Някъде се получава грешка при mutate()...

LIASettlemnts1 <- Settlements1 %>%
  filter(Късножелязна>=1)

LIASettlemnts1_2 <- Settlements1_2 %>%
  filter(Късножелязна>=1)

LIASettlemnts1 # Трябва да са 71

LIASettlemnts1_2 # Трябва да са 76





# КЖЕ. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 33, а Settlements1_2 35. В случая двата вида са по 34. Даже и едно съвпадение няма. Някъде се получава грешка при mutate()...

HellSettlemnts1 <- Settlements1 %>%
  filter(Елинизъм>=1)

HellSettlemnts1_2 <- Settlements1_2 %>%
  filter(Елинизъм>=1)

HellSettlemnts1 # Трябва да са 33

HellSettlemnts1_2 # Трябва да са 35





# KA. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 63, а Settlements1_2 69. В случая двата вида са по 69. Някъде се получава грешка при mutate()...

LASettlemnts1 <- Settlements1 %>%
  filter(Късноантична>=1)

LASettlemnts1_2 <- Settlements1_2 %>%
  filter(Късноантична>=1)

LASettlemnts1 # Трябва да са 63

LASettlemnts1_2 # Трябва да са 69





# Средновековие до XIV в. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 75, а Settlements1_2 88. В случая те са съответно по 86 и 88. Някъде се получава грешка при mutate()...

XIVSettlemnts1 <- Settlements1 %>%
  filter(СредновековиеXIV>=1)

XIVSettlemnts1_2 <- Settlements1_2 %>%
  filter(СредновековиеXIV>=1)

XIVSettlemnts1 # Трябва да са 75

XIVSettlemnts1_2 # Трябва да са 88




# Средновековие до XVII в. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 130, а Settlements1_2 136. В случая те са съответно по 133 и 136. Някъде се получава грешка при mutate()...

XVIISettlemnts1 <- Settlements1 %>%
  filter(СредновековиеXVII>=1)

XVIISettlemnts1_2 <- Settlements1_2 %>%
  filter(СредновековиеXVII>=1)

XVIISettlemnts1 # Трябва да са 130

XVIISettlemnts1_2 # Трябва да са 136





# Ранно средновековие. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 8, а Settlements1_2 13. В случая те са по 13. Някъде се получава грешка при mutate()...

EMASettlemnts1 <- Settlements1 %>%
  filter(Ранноср.>=1)

EMASettlemnts1_2 <- Settlements1_2 %>%
  filter(Ранноср.>=1)

EMASettlemnts1 # Трябва да са 8

EMASettlemnts1_2 # Трябва да са 13





# Зряло средновековие. РЕЗУЛТАТИТЕ НЕ СЪВПАДАТ С ТЕЗИ ОТ ГИС. Settlements1 трябва да бъдат 48, а Settlements1_2 58. В случая те са съответно по 57 и 58. Някъде се получава грешка при mutate()...

HMASettlemnts1 <- Settlements1 %>%
  filter(Зрялоср.>=1)

HMASettlemnts1_2 <- Settlements1_2 %>%
  filter(Зрялоср.>=1)

HMASettlemnts1 # Трябва да са 48

HMASettlemnts1_2 # Трябва да са 58





# Късно средновековие. Резултатите съвпадат с резултатите от ГИС. Но това е изкуствено заблуждение. Съвпадението е породено от това, че в КБЕ просто няма обекти с код 2. Проблемът с mutate() си остава. 

LMASettlemnts1 <- Settlements1 %>%
  filter(КСр.==1)

LMASettlemnts1_2 <- Settlements1_2 %>%
  filter(КСр.>=1)

LMASettlemnts1 # Трябва да са 72

LMASettlemnts1_2 # Трябва да са 74

```




Steps: 

1) generate owin for Box 1 or 2 simple features
2) intersect points with sf of Box 1 and 2 and convert the result to ppp object
3) run the nndist and r calculations




# unique(Sites$Вид)

















































## Settlements = 1

```{r}

# Филтрирам само обектите, които по един или друг начин, могат да бъдат класифицирани като селища. Ползваме файла Sites, който е генериран по горе от csv файл със всичките обекти 

# Филтрирам само обектите, които могат да бъдат определени като селищни. Тъй като тук ще изберем само обектите със сигурни датировки, затова кръщаваме файла Settl1

Settl1 <- filter(Sites, Вид == "Бани" | Вид == "Военен лагер/ град" | Вид == "Град" | Вид == "Единична постройка" | Вид == "Единична постройка?" | Вид == "Крепост" | Вид == "Крепост/ кула?" | Вид == "Крепост/ светилище?" | Вид == "Крепост/ селище?" | Вид == "Крепост?" | Вид == "Кула" | Вид == "Кула?" | Вид == "Манастир" | Вид == "Манастир/ черква?" | Вид == "Пътна станция" | Вид == "Пътна станция?" | Вид == "Светилище" | Вид == "Светилище/ селище?" | Вид == "Светилище?" | Вид == "Селище" | Вид == "Селище?" | Вид == "Селищна могила" | Вид == "Стопанство" | Вид == "Стопанство/ селище" | Вид == "Укрепен град" | Вид == "Укрепление?")%>%
  
# unique(Settl1_2$Вид)
  
# Следващата стъпка е да филтрирам само обектите със сигурни дати, без такива с колебаещи се дати. Това значи, че избирами за всяка епоха код == 1, а код 2 отпада. 
  filter( Пра.==1 | Палео.==1 | Нео.==1 | РНео.==1 | СНео.==1 | КНео.==1 | Х==1 | РХ==1 | КХ==1 | БЕ==1 | РБЕ==1 | РБЕ1==1 | РБЕ2==1 | РБЕ3==1 | СБЕ==1 | КБЕ==1 | ЖЕ==1 | РЖЕ==1 | РЖЕ1==1 | РЖЕ2==1 | КЖЕ==1 | КЖЕ1==1 | КЖЕ2==1 | А==1 | К==1 | Ел.==1 | РЕл.==1 | КЕл.==1 | РЕ==1 | КА==1 | КРЕ==1 | РВ==1 | Ср.==1 | РСр.==1 | ЗСр.==1 | КСр.==1 | ПБЦ==1 | ВБЦ==1 | Възраждане==1 | Неопр.==1)%>%
  
# Следващите редове ще направя колони в които ще бъдат събрани всичките кодове. По този начин ще мога да селектирам всичките обекти от праисторията или от средновековието. 
  
# Първо ще направим колона, в която ще обединим всичките праисторически обекти:
  
  mutate(Праистория=Пра.+Палео.+Нео.+РНео.+СНео.+КНео.+Х+РХ+КХ)%>%
  
  # Сега и за останалите епохи
  
  # Неолит:
  
  mutate(Неолит=Нео.+РНео.+СНео.+КНео.)%>%
  
  # Халколит:

  mutate(Халколит=Х+РХ+КХ)%>%
  
  # Бронзова епоха

  mutate(Бронз=БЕ+РБЕ+РБЕ1+РБЕ2+РБЕ3+СБЕ+КБЕ)%>%
  
  # Раннобронзова:
  
  mutate(Раннобронзова=РБЕ+РБЕ1+РБЕ2+РБЕ3)%>%
  
  # СБЕ няма регистрирани обекти
  
  # КБЕ няма други подпериоди, така че за нея ще използвам колоната КБЕ
  
  # Желязна

  mutate(Желязна=ЖЕ+РЖЕ+РЖЕ1+РЖЕ2+КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Ранножелязна:

  mutate(Ранножелязна=РЖЕ+РЖЕ1+РЖЕ2)%>%
  
  # Късножелязна:

  mutate(Късножелязна=КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Елинизъм:

  mutate(Елинизъм=Ел.+РЕл.+КЕл.)%>%
  
  # За римската епоха няма други подпериоди, така че за него ще използвам колоната РЕ.
  
  # За късноримската епоха няма други подпериоди, така че за него ще използвам колоната КРЕ.

  # Късноантична:

  mutate(Късноантична=КА+КРЕ+РВ)%>%

# Средновеквие (без Късното):

  mutate(СредновековиеXIV=Ср.+РСр.+ЗСр.+ПБЦ+ВБЦ)%>%

# Средновеквие (с Късното)

  mutate(СредновековиеXVII=Ср.+РСр.+ЗСр.+КСр.+ПБЦ+ВБЦ)%>%
  
# Ранно средновековие

  mutate(Ранноср.=РСр.+ПБЦ)%>%

# Зряло средновековие

  mutate(Зрялоср.=ЗСр.+ВБЦ)

# Късното средновековие няма други подпериоди, така че за него ще използвам колоната КСр.

Settl1

```

```{r}

# Тук селектирам само колоните, които ще са ми нужни, за да не затормозявам програмата с излишни такива. 

Settl1 <- select(Settl1, Cat, E_coord:N_coord, Вид, КБЕ, РЕ, КРЕ, Праистория:Зрялоср., КСр.)

```

## Settlements = 1+2 

```{r}

# Това е csv файлът, който заредих по-горе, с всичките обекти и даните за тях от Казанлъшката котловина. Файлът включва и обекти, основно крепости, които са регистрирани извън изследваната територия, основно да служат като спомагателни при анализите с пътищата.    

Sites

# Филтрирам само обектите, които по един или друг начин, могат да бъдат класифицирани като селища. Ползваме файла Sites, който е генериран по горе от csv файл със всичките обекти 

# Филтрирам само обектите, които могат да бъдат определени като селищни. Тъй като тук ще изберем и обектите със несигурни датировки, затова кръщаваме файла Settl1_2

Settl1_2 <- filter(Sites, Вид == "Бани" | Вид == "Военен лагер/ град" | Вид == "Град" | Вид == "Единична постройка" | Вид == "Единична постройка?" | Вид == "Крепост" | Вид == "Крепост/ кула?" | Вид == "Крепост/ светилище?" | Вид == "Крепост/ селище?" | Вид == "Крепост?" | Вид == "Кула" | Вид == "Кула?" | Вид == "Манастир" | Вид == "Манастир/ черква?" | Вид == "Пътна станция" | Вид == "Пътна станция?" | Вид == "Светилище" | Вид == "Светилище/ селище?" | Вид == "Светилище?" | Вид == "Селище" | Вид == "Селище?" | Вид == "Селищна могила" | Вид == "Стопанство" | Вид == "Стопанство/ селище" | Вид == "Укрепен град" | Вид == "Укрепление?")%>%
  
# unique(Settl1_2$Вид)
  
# Следващата стъпка е да филтрирам обектите със сигурни и несигурни дати, без такива с колебаещи се дати. Това значи, че избирами за всяка епоха код >= 1 
  filter( Пра.>=1 | Палео.>=1 | Нео.>=1 | РНео.>=1 | СНео.>=1 | КНео.>=1 | Х>=1 | РХ>=1 | КХ>=1 | БЕ>=1 | РБЕ>=1 | РБЕ1>=1 | РБЕ2>=1 | РБЕ3>=1 | СБЕ>=1 | КБЕ>=1 | ЖЕ>=1 | РЖЕ>=1 | РЖЕ1>=1 | РЖЕ2>=1 | КЖЕ>=1 | КЖЕ1>=1 | КЖЕ2>=1 | А>=1 | К>=1 | Ел.>=1 | РЕл.>=1 | КЕл.>=1 | РЕ>=1 | КА>=1 | КРЕ>=1 | РВ>=1 | Ср.>=1 | РСр.>=1 | ЗСр.>=1 | КСр.>=1 | ПБЦ>=1 | ВБЦ>=1 | Възраждане>=1 | Неопр.>=1)%>%
  
# Следващите редове ще направя колони в които ще бъдат събрани всичките кодове. По този начин ще мога да селектирам всичките обекти от праисторията или от средновековието. 
  
# Първо ще направим колона, в която ще обединим всичките праисторически обекти:
  
  mutate(Праистория=Пра.+Палео.+Нео.+РНео.+СНео.+КНео.+Х+РХ+КХ)%>%
  
  # Сега и за останалите епохи
  
  # Неолит:
  
  mutate(Неолит=Нео.+РНео.+СНео.+КНео.)%>%
  
  # Халколит:

  mutate(Халколит=Х+РХ+КХ)%>%
  
  # Бронзова епоха

  mutate(Бронз=БЕ+РБЕ+РБЕ1+РБЕ2+РБЕ3+СБЕ+КБЕ)%>%
  
  # Раннобронзова:
  
  mutate(Раннобронзова=РБЕ+РБЕ1+РБЕ2+РБЕ3)%>%
  
  # СБЕ няма регистрирани обекти
  
  # КБЕ няма други подпериоди, така че за нея ще използвам колоната КБЕ
  
  # Желязна

  mutate(Желязна=ЖЕ+РЖЕ+РЖЕ1+РЖЕ2+КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Ранножелязна:

  mutate(Ранножелязна=РЖЕ+РЖЕ1+РЖЕ2)%>%
  
  # Късножелязна:

  mutate(Късножелязна=КЖЕ+КЖЕ1+КЖЕ2+К+Ел.+РЕл.+КЕл.)%>%
  
  # Елинизъм:

  mutate(Елинизъм=Ел.+РЕл.+КЕл.)%>%
  
  # За римската епоха няма други подпериоди, така че за него ще използвам колоната РЕ.
  
  # За късноримската епоха няма други подпериоди, така че за него ще използвам колоната КРЕ.

  # Късноантична:

  mutate(Късноантична=КА+КРЕ+РВ)%>%

# Средновеквие (без Късното):

  mutate(СредновековиеXIV=Ср.+РСр.+ЗСр.+ПБЦ+ВБЦ)%>%

# Средновеквие (с Късното)

  mutate(СредновековиеXVII=Ср.+РСр.+ЗСр.+КСр.+ПБЦ+ВБЦ)%>%
  
# Ранно средновековие

  mutate(Ранноср.=РСр.+ПБЦ)%>%

# Зряло средновековие

  mutate(Зрялоср.=ЗСр.+ВБЦ)

# Късното средновековие няма други подпериоди, така че за него ще използвам колоната КСр.

Settl1_2

```

```{r}

# Тук селектирам само колоните, които ще са ми нужни, за да не затормозявам програмата с излишни такива. 
# Забележи функцията dplyr::select(). Това е защото съм заредил и функцията sf(), която се конфронтира с dplyr и се появява грешка, за това трябваше изрично да кажа, на R, че искам да използвам функцията select() на dplyr

Settl1_2 <- dplyr::select(Settl1_2, Cat, E_coord:N_coord, Вид, КБЕ, РЕ, КРЕ, Праистория:Зрялоср., КСр.)

Settl1_2

```


```{r}

LBESettl1 <- Settl1 %>%
  filter(КБЕ>=1)

LBESettl1_2 <- Settl1_2 %>%
  filter(КБЕ>=1)

LBESettl1

LBESettl1_2



RPSettl1 <- Settl1 %>%
  filter(РЕ==1)

RPSettl1_2 <- Settl1_2 %>%
  filter(РЕ>=1)

RPSettl1

RPSettl1_2



LRPSettl1 <- Settl1 %>%
  filter(КРЕ>=1)

LRPSettl1_2 <- Settl1_2 %>%
  filter(КРЕ>=1)

LRPSettl1

LRPSettl1_2




PreSettl1 <- Settl1 %>%
  filter(Праистория>=1)

PreSettl1_2 <- Settl1_2 %>%
  filter(Праистория>=1)

PreSettl1

PreSettl1_2




NeoSettl1 <- Settl1 %>%
  filter(Неолит>=1)

NeoSettl1_2 <- Settl1_2 %>%
  filter(Неолит>=1)

NeoSettl1

NeoSettl1_2




HalcSettl1 <- Settl1 %>%
  filter(Халколит>=1)

HalcSettl1_2 <- Settl1_2 %>%
  filter(Халколит>=1)

HalcSettl1

HalcSettl1_2




BASettl1 <- Settl1 %>%
  filter(Бронз>=1)

BASettl1_2 <- Settl1_2 %>%
  filter(Бронз>=1)

BASettl1

BASettl1_2





EBASettl1 <- Settl1 %>%
  filter(Раннобронзова>=1)

EBASettl1_2 <- Settl1_2 %>%
  filter(Раннобронзова>=1)

EBASettl1

EBASettl1_2






IASettl1 <- Settl1 %>%
  filter(Желязна>=1)

IASettl1_2 <- Settl1_2 %>%
  filter(Желязна>=1)

IASettl1

IASettl1_2



EIASettl1 <- Settl1 %>%
  filter(Ранножелязна>=1)

EIASettl1_2 <- Settl1_2 %>%
  filter(Ранножелязна>=1)

EIASettl1

EIASettl1_2




LIASettl1 <- Settl1 %>%
  filter(Късножелязна>=1)

LIASettl1_2 <- Settl1_2 %>%
  filter(Късножелязна>=1)

LIASettl1

LIASettl1_2







HellSettl1 <- Settl1 %>%
  filter(Елинизъм>=1)

HellSettl1_2 <- Settl1_2 %>%
  filter(Елинизъм>=1)

HellSettl1

HellSettl1_2




LASettl1 <- Settl1 %>%
  filter(Късноантична>=1)

LASettl1_2 <- Settl1_2 %>%
  filter(Късноантична>=1)

LASettl1

LASettl1_2



XIVSettl1 <- Settl1 %>%
  filter(СредновековиеXIV>=1)

XIVSettl1_2 <- Settl1_2 %>%
  filter(СредновековиеXIV>=1)

XIVSettl1

XIVSettl1_2






XVIISettl1 <- Settl1 %>%
  filter(СредновековиеXVII>=1)

XVIISettl1_2 <- Settl1_2 %>%
  filter(СредновековиеXVII>=1)

XVIISettl1

XVIISettl1_2







EMASettl1 <- Settl1 %>%
  filter(Ранноср.>=1)

EMASettl1_2 <- Settl1_2 %>%
  filter(Ранноср.>=1)

EMASettl1

EMASettl1_2







HMASettl1 <- Settl1 %>%
  filter(Зрялоср.>=1)

HMASettl1_2 <- Settl1_2 %>%
  filter(Зрялоср.>=1)

HMASettl1

HMASettl1_2







LMASettl1 <- Settl1 %>%
  filter(КСр.>=1)

LMASettl1_2 <- Settl1_2 %>%
  filter(КСр.>=1)

LMASettl1

LMASettl1_2

```












